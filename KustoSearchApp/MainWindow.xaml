<Window x:Class="KustoSearchApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Azure Data Explorer - Table Search Tool" 
        Height="800" Width="1300" MinHeight="650" MinWidth="1000"
        Background="{StaticResource DarkBackground}"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PanelBackground}" Padding="24,16">
            <StackPanel>
                <TextBlock Text="ðŸ” Azure Data Explorer Search" 
                           FontSize="22" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimary}"/>
                <TextBlock Text="Search across all tables in your Kusto cluster" 
                           FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,4,0,0"/>
            </StackPanel>
        </Border>

        <!-- Connection Panel -->
        <Border Grid.Row="1" Background="{StaticResource CardBackground}" 
                Margin="20,16,20,0" CornerRadius="8" Padding="20,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,20,0">
                    <TextBlock Text="CLUSTER URL" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox x:Name="txtClusterUrl" Style="{StaticResource ModernTextBox}"
                             Text="https://wawsweu.kusto.windows.net"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="0,0,20,0">
                    <TextBlock Text="DATABASE" FontSize="11" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                    <TextBox x:Name="txtDatabase" Style="{StaticResource ModernTextBox}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <Button x:Name="btnHistory" Content="ðŸ“‹" 
                            Style="{StaticResource SecondaryButton}" 
                            Width="38" Height="38" Margin="0,0,8,0"
                            ToolTip="Previous connections"
                            Click="btnHistory_Click"/>
                    <Button x:Name="btnConnect" Content="âš¡ Connect" 
                            Style="{StaticResource ModernButton}" 
                            Width="140" Height="38"
                            Click="btnConnect_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Search & Date Filters -->
        <Grid Grid.Row="2" Margin="20,16,20,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Search Terms -->
            <Border Grid.Column="0" Background="{StaticResource CardBackground}" 
                    CornerRadius="8" Padding="20,16" Margin="0,0,12,0">
                <StackPanel>
                    <TextBlock Text="ðŸ”Ž Search Terms (AND logic)" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextPrimary}" Margin="0,0,0,12"/>
                    <ItemsControl x:Name="SearchTermsPanel">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource ModernTextBox}"/>
                                    <Button Grid.Column="1" Content="âœ•" Width="36" Height="36" Margin="8,0,0,0"
                                            Style="{StaticResource RedButton}" Padding="0"
                                            Click="RemoveSearchTerm_Click" Tag="{Binding}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Button x:Name="btnAddSearchTerm" Content="+ Add Search Term" 
                            Style="{StaticResource SecondaryButton}" 
                            HorizontalAlignment="Left" Margin="0,4,0,0"
                            Click="btnAddSearchTerm_Click"/>
                </StackPanel>
            </Border>

            <!-- Date Filter -->
            <Border Grid.Column="1" Background="{StaticResource CardBackground}" 
                    CornerRadius="8" Padding="20,16">
                <StackPanel>
                    <TextBlock Text="ðŸ“… Date Filter" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextPrimary}" Margin="0,0,0,12"/>
                    
                    <TextBlock Text="Start Date (yyyy-MM-dd HH:mm:ss)" FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,4"/>
                    <TextBox x:Name="txtStartDate" Style="{StaticResource ModernTextBox}"
                             ToolTip="Format: yyyy-MM-dd HH:mm:ss"/>
                    
                    <TextBlock Text="End Date (yyyy-MM-dd HH:mm:ss)" FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,12,0,4"/>
                    <TextBox x:Name="txtEndDate" Style="{StaticResource ModernTextBox}"
                             ToolTip="Format: yyyy-MM-dd HH:mm:ss"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Action Buttons & Status -->
        <Border Grid.Row="3" Background="{StaticResource PanelBackground}" 
                Margin="20,16,20,0" CornerRadius="8" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" x:Name="btnSearch" Content="â–¶ Search Tables" 
                        Style="{StaticResource GreenButton}" Width="150" Height="40"
                        Click="btnSearch_Click"/>
                
                <Button Grid.Column="1" x:Name="btnStop" Content="â¹ Stop" 
                        Style="{StaticResource RedButton}" Width="100" Height="40" Margin="10,0,0,0"
                        Visibility="Collapsed" Click="btnStop_Click"/>

                <Button Grid.Column="2" x:Name="btnCopyKql" Content="ðŸ“‹ Copy KQL" 
                        Style="{StaticResource OrangeButton}" Width="120" Height="40" Margin="10,0,0,0"
                        Click="btnCopyKql_Click"/>

                <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0">
                    <TextBlock x:Name="txtStatus" Text="âš« Ready" 
                               Foreground="{StaticResource TextSecondary}" FontSize="12"/>
                    <TextBlock x:Name="txtTablesCount" Text="â”‚ Tables: 0" 
                               Foreground="{StaticResource TextSecondary}" FontSize="12" Margin="12,0,0,0"/>
                </StackPanel>

                <Button Grid.Column="4" x:Name="btnManageTables" Content="âš™ Manage Tables" 
                        Style="{StaticResource ModernButton}" Width="140" Height="40"
                        Click="btnManageTables_Click"/>

                <Button Grid.Column="5" x:Name="btnClear" Content="ðŸ—‘ Clear" 
                        Style="{StaticResource SecondaryButton}" Width="100" Height="40" Margin="10,0,0,0"
                        Click="btnClear_Click"/>

                <Button Grid.Column="6" x:Name="btnExport" Content="ðŸ“¥ Export" 
                        Style="{StaticResource SecondaryButton}" Width="100" Height="40" Margin="10,0,0,0"
                        Click="btnExport_Click"/>
            </Grid>
        </Border>

        <!-- Main Content: DataGrid + Selected Tables -->
        <Grid Grid.Row="4" Margin="20,16,20,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <!-- Results DataGrid -->
            <Border Grid.Column="0" CornerRadius="8" Margin="0,0,12,0" ClipToBounds="True">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <ProgressBar x:Name="progressBar" Grid.Row="0" Height="4" 
                                 Background="{StaticResource DarkBackground}" 
                                 Foreground="{StaticResource AccentGreen}" BorderThickness="0"/>
                    
                    <DataGrid Grid.Row="1" x:Name="dgResults" 
                              AutoGenerateColumns="False" 
                              CanUserAddRows="False" 
                              CanUserDeleteRows="False"
                              IsReadOnly="False"
                              SelectionMode="Extended"
                              SelectionUnit="FullRow">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="âœ“" Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}" Width="50"/>
                            <DataGridTextColumn Header="Table Name" Binding="{Binding TableName}" Width="*" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Match Count" Binding="{Binding MatchCount}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Has Matches" Binding="{Binding HasMatches}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Duration (ms)" Binding="{Binding Duration}" Width="100" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Error" Binding="{Binding Error}" Width="150" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- Selected Tables Sidebar -->
            <Border Grid.Column="1" Background="{StaticResource CardBackground}" 
                    CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="ðŸ“‹ Selected Tables" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextPrimary}" Margin="0,0,0,12"/>
                    
                    <TextBox Grid.Row="1" x:Name="txtSelectedTables" 
                             Style="{StaticResource ModernTextBox}"
                             AcceptsReturn="True" TextWrapping="NoWrap"
                             VerticalScrollBarVisibility="Auto"
                             FontFamily="Consolas" FontSize="11"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Log Panel -->
        <Border Grid.Row="5" Background="#14141E" Margin="20,16,20,20" CornerRadius="8" Padding="12">
            <TextBox x:Name="txtLog" 
                     Background="Transparent" 
                     Foreground="#4ADE80" 
                     BorderThickness="0"
                     FontFamily="Cascadia Code, Consolas" 
                     FontSize="11"
                     IsReadOnly="True"
                     AcceptsReturn="True"
                     TextWrapping="NoWrap"
                     VerticalScrollBarVisibility="Auto"
                     Height="100"/>
        </Border>
    </Grid>
</Window>
