<Window x:Class="KustoSearchApp.TableSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:KustoSearchApp"
        Title="Select Tables to Search" 
        Height="600" Width="900" MinHeight="500" MinWidth="750"
        Background="{StaticResource DarkBackground}"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="ðŸ” Select tables to search - Fuzzy matching with highlights" 
                   FontSize="13" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,16"/>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="120"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Available Tables -->
            <Border Grid.Column="0" Background="{StaticResource CardBackground}" CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="ðŸ“‹ Available Tables" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource TextPrimary}" Margin="0,0,0,8"/>

                    <TextBox Grid.Row="1" x:Name="txtFilterAvailable" 
                             Style="{StaticResource ModernTextBox}"
                             TextChanged="TxtFilterAvailable_TextChanged"
                             Tag="ðŸ”Ž Fuzzy filter (e.g. 'sysev' â†’ 'SystemEvents')..."/>

                    <TextBlock Grid.Row="2" x:Name="lblAvailableCount" Text="0 tables" 
                               FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,8,0,8"/>

                    <ListBox Grid.Row="3" x:Name="lstAvailable" 
                             Background="{StaticResource DarkBackground}"
                             Foreground="{StaticResource TextPrimary}"
                             BorderBrush="{StaticResource BorderBrush}"
                             FontFamily="Consolas" FontSize="11"
                             SelectionMode="Extended"
                             MouseDoubleClick="LstAvailable_DoubleClick">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="8,6"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock local:HighlightBehavior.SourceText="{Binding Name}"
                                           local:HighlightBehavior.HighlightPattern="{Binding ElementName=txtFilterAvailable, Path=Text}"
                                           Foreground="{StaticResource TextPrimary}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Action Buttons -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0">
                <Button Content="Add â–¶" Style="{StaticResource ModernButton}" 
                        Width="100" Height="38" Margin="0,4" Click="BtnAdd_Click"/>
                <Button Content="Add All â–¶â–¶" Style="{StaticResource SecondaryButton}" 
                        Width="100" Height="38" Margin="0,4" Click="BtnAddAll_Click"/>
                <Rectangle Height="20"/>
                <Button Content="â—€ Remove" Style="{StaticResource ModernButton}" 
                        Width="100" Height="38" Margin="0,4" Click="BtnRemove_Click"/>
                <Button Content="â—€â—€ Remove All" Style="{StaticResource SecondaryButton}" 
                        Width="100" Height="38" Margin="0,4" Click="BtnRemoveAll_Click"/>
            </StackPanel>

            <!-- Selected Tables -->
            <Border Grid.Column="2" Background="{StaticResource CardBackground}" CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="âœ… Selected Tables" FontSize="13" FontWeight="SemiBold" 
                               Foreground="{StaticResource AccentGreen}" Margin="0,0,0,8"/>

                    <TextBox Grid.Row="1" x:Name="txtFilterSelected" 
                             Style="{StaticResource ModernTextBox}"
                             TextChanged="TxtFilterSelected_TextChanged"
                             Tag="ðŸ”Ž Fuzzy filter selected..."/>

                    <TextBlock Grid.Row="2" x:Name="lblSelectedCount" Text="0 selected" 
                               FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource AccentGreen}" Margin="0,8,0,8"/>

                    <ListBox Grid.Row="3" x:Name="lstSelected" 
                             Background="{StaticResource DarkBackground}"
                             Foreground="{StaticResource TextPrimary}"
                             BorderBrush="{StaticResource BorderBrush}"
                             FontFamily="Consolas" FontSize="11"
                             SelectionMode="Extended"
                             MouseDoubleClick="LstSelected_DoubleClick">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="8,6"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock local:HighlightBehavior.SourceText="{Binding Name}"
                                           local:HighlightBehavior.HighlightPattern="{Binding ElementName=txtFilterSelected, Path=Text}"
                                           Foreground="{StaticResource TextPrimary}"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
        </Grid>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="âœ“ OK" Style="{StaticResource GreenButton}" 
                    Width="120" Height="42" Margin="0,0,12,0" Click="BtnOk_Click"/>
            <Button Content="Cancel" Style="{StaticResource SecondaryButton}" 
                    Width="100" Height="42" Click="BtnCancel_Click"/>
        </StackPanel>
    </Grid>
</Window>
